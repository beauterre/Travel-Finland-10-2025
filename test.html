<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gallery with Lightbox and Controls</title>
<style>
body {font-family: Arial, sans-serif; margin:0; background:#f0f8ff;}
h1 {text-align:center; margin:20px auto;}
#gallery {
  display:flex; flex-wrap:nowrap; gap:1rem; padding:20px;
  width:calc(100% - 20px); overflow-x:auto; overflow-y:hidden;
  box-shadow:inset 0 4px 10px rgba(0,0,0,0.2);
  max-height:60vh;
}
#gallery .thumb {
  min-width:150px; max-width:150px; height:150px; flex-shrink:0;
  border-radius:8px; overflow:hidden; cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,0.2);
  position:relative;
}
.thumb img {width:100%; height:100%; object-fit:cover;}
.thumb.video .play-btn {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width:40px; height:40px; border-radius:50%; background:rgba(0,0,0,0.7);
  color:#fff; display:flex; align-items:center; justify-content:center;
  font-size:20px; pointer-events:none;
}
.modal {
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,0.8); justify-content:center; align-items:center;
  z-index:1000;
}
.modal-content {
  position:relative; background:#fff; padding:20px;
  border-radius:12px; text-align:center; overflow:hidden;
  display:flex; justify-content:center; align-items:center;
  max-width:90vw; max-height:90vh;
  transition:width 0.3s,height 0.3s;
}
#modal-media img, #modal-media iframe {
  max-width:100%; max-height:80vh; object-fit:contain;
  transition:transform 0.3s ease-in-out;
}
.close-btn {
  position:absolute; top:10px; right:10px; font-size:30px;
  width:30px; height:30px; background:#fff; border-radius:15px;
  cursor:pointer; z-index:10;
}
.controls {
  position:absolute; top:10px; left:50%; transform:translateX(-50%);
  display:flex; gap:10px; z-index:10;
}
.control-btn {
  background:rgba(0,0,0,0.6); color:white; border:none;
  padding:10px; font-size:18px; cursor:pointer;
  border-radius:50%; width:40px; height:40px;
  display:flex; justify-content:center; align-items:center;
}
.control-btn:hover {background:rgba(0,0,0,0.9);}
</style>
</head>
<body>
<h1>Gallery with Lightbox and Controls</h1>
<div id="gallery"></div>

<div id="modal" class="modal">
  <div class="modal-content">
    <span id="closeBtn" class="close-btn">&times;</span>
    <div id="modal-media"></div>
    <div class="controls">
      <button id="prevBtn" class="control-btn">‚ùÆ</button>
      <button id="rotateBtn" class="control-btn">üîÑ</button>
      <button id="nextBtn" class="control-btn">‚ùØ</button>
    </div>
  </div>
</div>

<script>
const photoPath = "./fotos/Dag9/";
const items = [
  { kind:"image", url:"Screenshot_20251010-175907.png" },
  { kind:"youtube", id:"JYt82UGhnOM" },
  { kind:"youtube", id:"uk500H2d274" },
  { kind:"image", url:"IMG-20251010-WA0003.jpeg" }
];

let currentIndex = -1;
let rotationAngle = 0;

const gallery = document.getElementById('gallery');
const modal = document.getElementById('modal');
const modalMedia = document.getElementById('modal-media');
const rotateBtn = document.getElementById('rotateBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const closeBtn = document.getElementById('closeBtn');
const modalContent = document.querySelector('.modal-content');

// Build gallery thumbnails
items.forEach((item, i) => {
  const thumb = document.createElement('div');
  thumb.classList.add('thumb');
  const img = document.createElement('img');
  if(item.kind === 'image') {
    img.src = photoPath + item.url;
  } else {
    img.src = `https://img.youtube.com/vi/${item.id}/0.jpg`;
    thumb.classList.add('video');
    const playBtn = document.createElement('div');
    playBtn.classList.add('play-btn');
    playBtn.innerHTML = '‚ñ∂';
    thumb.appendChild(playBtn);
  }
  img.dataset.index = i;
  thumb.appendChild(img);
  gallery.appendChild(thumb);
});

gallery.addEventListener('click', e => {
  const target = e.target.closest('.thumb img');
  if(!target) return;
  currentIndex = parseInt(target.dataset.index);
  rotationAngle = 0;
  showMedia(currentIndex);
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
});

// FIX: Maintain rotation & dynamic resizing
function showMedia(index) {
  const item = items[index];
  modalMedia.innerHTML = '';
  let el;
  if(item.kind === 'image') {
    el = document.createElement('img');
    el.src = photoPath + item.url;
  } else {
    el = document.createElement('iframe');
    el.src = `https://www.youtube.com/embed/${item.id}?autoplay=1`;
    el.allow = "accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture";
    el.allowFullscreen = true;
    // FIX: enforce large visible size
    el.style.width = '80vw';
    el.style.height = '45vw'; // 16:9 ratio
    el.style.maxHeight = '80vh';
  }
  el.style.transform = `rotate(${rotationAngle}deg)`;
  modalMedia.appendChild(el);
  adjustModalSize(rotationAngle);
}

// FIX: Rotation without reloading media
rotateBtn.addEventListener('click', () => {
  rotationAngle = (rotationAngle + 90) % 360;
  const el = modalMedia.firstElementChild;
  if(!el) return;
  el.style.transform = `rotate(${rotationAngle}deg)`;
  adjustModalSize(rotationAngle);
});

function adjustModalSize(angle) {
  if(angle === 90 || angle === 270) {
    modalContent.style.width = '80vh'; // flip width/height
    modalContent.style.height = '80vw';
  } else {
    modalContent.style.width = '80vw';
    modalContent.style.height = 'auto';
  }
}

nextBtn.addEventListener('click', () => {
  currentIndex = (currentIndex + 1) % items.length;
  rotationAngle = 0;
  showMedia(currentIndex);
});
prevBtn.addEventListener('click', () => {
  currentIndex = (currentIndex - 1 + items.length) % items.length;
  rotationAngle = 0;
  showMedia(currentIndex);
});
closeBtn.addEventListener('click', closeModal);
window.addEventListener('click', e => { if(e.target === modal) closeModal(); });

function closeModal() {
  modal.style.display = 'none';
  document.body.style.overflow = 'auto';
  modalMedia.innerHTML = '';
}
</script>
</body>
</html>
