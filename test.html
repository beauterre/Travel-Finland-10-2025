<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/jpeg" href="favicon.jpg">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reisverslag Finland - Dag 9 (10 oktober 2025)</title>
<link rel="stylesheet" href="new_style.css">
<style>
  :root { --overlay-pad: 0.05; }
  body { margin:0; font-family:Arial,Helvetica,sans-serif; background:#f0f8ff; }
  h1 { text-align:center; margin:18px 0; }
  #gallery { display:flex; gap:12px; padding:16px; overflow-x:auto; box-shadow: inset 0 4px 10px rgba(0,0,0,.15); }
  .thumb { flex:0 0 150px; height:150px; border-radius:8px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.15); cursor:pointer; position:relative; }
  .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
  .thumb.video .play-btn { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:40px; height:40px; border-radius:50%; background:rgba(0,0,0,.65); color:#fff; display:flex; align-items:center; justify-content:center; pointer-events:none; }
  .modal { position:fixed; inset:0; display:none; background:rgba(0,0,0,.85); justify-content:center; align-items:center; z-index:9999; }
  .modal-content {
    position:relative;
    background:#fff;
    border-radius:12px;
    overflow:visible;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:8px;
    box-sizing:border-box;
    border:2px solid rgba(255,255,255,0.85);
    transition:all 0.18s ease;
    will-change:width,height;
  }
  #modal-media { display:block; transform-origin:center center; }
  .close-btn { position:absolute; right:10px; top:10px; background:#fff; border-radius:50%; width:34px; height:34px; text-align:center; line-height:34px; font-size:20px; cursor:pointer; z-index:20; }
  .controls { position:absolute; top:10px; left:50%; transform:translateX(-50%); display:flex; gap:8px; z-index:20; }
  .control-btn { width:40px; height:40px; border-radius:50%; background:rgba(0,0,0,.6); color:#fff; border:none; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; }
</style>
</head>
<body>
  
<script>
/* ---------- Data ---------- */
  const startDate = "9/10/2025";
  const dag = 9;
  
  const agenda = [
  { time: "8:00", message: "opgestaan" },
  { time: "8:08", message: "Nieuwe meditatie, geeft enorm veel energie." },
  { time: "10:30", message: "Met buurvrouw Tuupu en Liisa naar winkelcentrum, daar voor Raagi nieuwe DNA abonnement geregeld en voor mezelf een DNA toeristenkaart. Volgens de man van de DNA shop werkt dat beter dan Elisa in M√§ker√§ :) Jali wordt al snel Jari (een 'echte' Finse naam) maar Raagi vind Jali leuker. Ik wil de betalen voor de benzine, maar buurvrouw Liisa zei dat dat prima was, maar dat ze me dan wel ging slaan :) Burendiensten zijn hier gewoon." },
  { time: "12:30", message: "Lunch gepakt en begonnen aan herfstrondrit. Dit is waarschijnlijk de laatste dag met flink zon." },
  { time: "18:30", message: "Doodmoe nu, vergeten te mediteren, maar prachtige tocht gemaakt.. heel veel gefilmd en gefotografeerd." },
  { time: "20:00", message: "Gegeten.. Raagi heeft de ijsmachine uitgelegd.. We zijn direct gaan experimenteren met kokosmelk en amandelmelk en agavesiroop.. morgen kunnen we ijs maken ervan. Erg leuk." },
  { time: "20:26", message: "Ga nu slapen, morgen blijven we thuis, komt de aannemer, vroeg.. kan ik alles bijwerken, komen ook de foto¬¥s en filmpjes.... nu, 12 oktober.. 22:11 gelukt, geloof ik.." }
];

const photoPath = "./fotos/Dag9/";
const items = [
  { kind: "image", url: "Screenshot_20251010-175907.png" }, 

  { kind: "youtube", id: "JYt82UGhnOM" }, 
  { kind: "youtube", id: "uk500H2d274" }, 
  { kind: "youtube", id: "2fGf_YFchRM" }, 
  { kind: "youtube", id: "znYZmf6yetA" }, 
  { kind: "youtube", id: "1JZkNYbJpjw" }, 
  { kind: "youtube", id: "d7wIWFS-U8s" }, 
  { kind: "youtube", id: "RNxJ1nIHrvk" }, 
  { kind: "youtube", id: "_12uPhPoj3c" }, 
  { kind: "youtube", id: "7McTWFjGgRQ" }, 
  { kind: "youtube", id: "mY4wT9diCY4" }, 
  { kind: "youtube", id: "65fpQlDfQOM" }, 
  { kind: "youtube", id: "0kKeZzPXBPI" }, 
  { kind: "youtube", id: "6hmMiU5AU28" }, 
  { kind: "youtube", id: "uvUj3tIPgb4" }, 
  { kind: "youtube", id: "W1In7UDRUgM" }, 
  { kind: "youtube", id: "7kk9S5dpWks" }, 
  { kind: "youtube", id: "891zlweu8ck" }, 
  { kind: "youtube", id: "PI6751cuxzY" }, 
  { kind: "youtube", id: "2uf7hgXJtxs" }, 
  { kind: "youtube", id: "Y28qwQQfh9o" }, 
  { kind: "youtube", id: "6br0QBjWueA" }, 
  { kind: "youtube", id: "RrINQhup-l4" }, 
  { kind: "youtube", id: "hRAHkf0u4qA" }, 
  { kind: "youtube", id: "yHUgVB3Ftsk" }, 
  { kind: "youtube", id: "CKrMOvK8DSo" },
  { kind: "image", url: "IMG-20251010-WA0003.jpeg" }, 
  { kind: "image", url: "IMG-20251010-WA0005.jpeg" }, 
  { kind: "image", url: "photo_2025-10-10T11-02-01-497Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-02-03-954Z.png", setAsBackground:true  }, 
  { kind: "image", url: "photo_2025-10-10T11-02-20-727Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-02-36-202Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-03-26-105Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-04-27-563Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-04-35-425Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-05-12-240Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-24-38-267Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-24-48-321Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T11-25-53-103Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-38-17-075Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-38-28-221Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-38-49-659Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-39-06-814Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-39-18-963Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-39-40-407Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-39-58-395Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-40-04-330Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-40-27-039Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-40-41-813Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-40-47-946Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-41-34-909Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T12-41-45-960Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T13-00-57-459Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T13-46-08-377Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-03-46-516Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-03-52-670Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-05-11-456Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-05-33-954Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-06-27-254Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-06-31-948Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-07-38-457Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-08-23-794Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-08-34-109Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-08-42-503Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-09-38-030Z.png" }, 
  { kind: "image", url: "photo_2025-10-10T14-10-22-316Z.png" }
];

// script lib
  function renderTitle()
    {
      // Parse startDate
const [dayStr, monthStr, yearStr] = startDate.split('/');
const start = new Date(Number(yearStr), Number(monthStr) - 1, Number(dayStr));

// Compute current day
const current = new Date(start);
current.setDate(start.getDate() + (dag - 1)); // add dag-1 days

// Format date in Dutch style (e.g., 10 oktober 2025)
const monthsNL = ["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"];
const formattedDate = `${current.getDate()} ${monthsNL[current.getMonth()]} ${current.getFullYear()}`;

// Build title
const title = `üá´üáÆ Reisverslag Finland üìÖ Dag ${dag} (${formattedDate})`;
      document.title = title;
let h1=document.createElement("h1");
      h1.innerText=title;
      document.body.appendChild(h1);

var buttons_html='<div class="top-buttons-container"><a class="top-button" href="index.html">Terug naar de agenda</a><a class="top-button" href="dag'+(dag-1)+'.html">Vorige dag</a><a class="top-button" href="dag'+(dag+1)+'.html">Volgende dag</a></div>';
let div=document.createElement("div");
      div.innerHTML=buttons_html;
      document.body.appendChild(div);
      
    }
 
  function renderAgenda() 
  {
  let containerEl=document.createElement("div");
    document.body.appendChild(containerEl)
  const ul = document.createElement('ul');
  ul.className = 'agenda';

  agenda.forEach(entry => {
    const li = document.createElement('li');
    li.innerHTML = `<span class="time">${entry.time}</span>${entry.message}`;
    ul.appendChild(li);
  });

  // Clear previous content and append
  containerEl.innerHTML = '';
  containerEl.appendChild(ul);
}
function renderGallery()
  {
      let gal=document.createElement("div");
    gal.id="gallery";
    document.body.appendChild(gal);
  }
  function renderModal() {
  // Check if modal already exists
  if (document.getElementById('modal')) return;

  const modalHTML = `
    <div id="modal" class="modal" aria-hidden="true">
      <div class="modal-content" id="modalContent">
        <span id="closeBtn" class="close-btn" title="Close">&times;</span>
        <div id="modal-media"></div>
        <div class="controls">
          <button id="prevBtn" class="control-btn" title="Previous">‚ùÆ</button>
          <button id="rotateBtn" class="control-btn" title="Rotate">üîÑ</button>
          <button id="nextBtn" class="control-btn" title="Next">‚ùØ</button>
        </div>
      </div>
    </div>
  `;

  // Append modal to body
  document.body.insertAdjacentHTML('beforeend', modalHTML);
}
  // now make the page
   renderTitle();
   renderGallery();
    renderAgenda();
   renderModal();


  
/* ensure angle persistence */
items.forEach(i => { if (typeof i.angle !== 'number') i.angle = 0; });

/* ---------- State & refs ---------- */
let currentIndex = -1;
let rotationAngle = 0;
const gallery = document.getElementById('gallery');
const modal = document.getElementById('modal');
const modalMedia = document.getElementById('modal-media');
const modalContent = document.getElementById('modalContent');
const rotateBtn = document.getElementById('rotateBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const closeBtn = document.getElementById('closeBtn');

/* ---------- Thumbnails ---------- */
items.forEach((item, idx) => {
  const t = document.createElement('div');
  t.className = 'thumb' + (item.kind === 'youtube' ? ' video' : '');
  const img = document.createElement('img');
  img.dataset.index = idx;
  if (item.kind === 'image') {
    img.src = photoPath + item.url;
    img.alt = item.url;
  } else {
    img.src = `https://img.youtube.com/vi/${item.id}/hqdefault.jpg`;
    img.alt = 'YouTube thumbnail';
    const play = document.createElement('div'); play.className='play-btn'; play.textContent='‚ñ∂';
    t.appendChild(play);
  }
  t.appendChild(img);
  gallery.appendChild(t);
});

/* ---------- Open modal ---------- */
gallery.addEventListener('click', (ev) => {
  const img = ev.target.closest('.thumb img');
  if (!img) return;
  currentIndex = Number(img.dataset.index);
  rotationAngle = items[currentIndex].angle || 0;
  openModal(currentIndex);
});

function openModal(index) {
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden', 'false');
  document.body.style.overflow = 'hidden';
  showMedia(index);
}
function closeModal() {
  modal.style.display = 'none';
  modal.setAttribute('aria-hidden', 'true');
  document.body.style.overflow = '';
  modalMedia.innerHTML = '';
}

/* ---------- Core sizing logic (correct math) ---------- */
function showMedia(index) {
  modalMedia.innerHTML = '';
  const item = items[index];
  let el;
  if (item.kind === 'image') {
    el = document.createElement('img');
    el.src = photoPath + item.url;
    el.style.display = 'block';
    el.style.transformOrigin = '50% 50%';
    el.onload = () => {
      const natW = el.naturalWidth || el.width || 800;
      const natH = el.naturalHeight || el.height || 600;
      computeAndApply(el, natW, natH);
    };
    el.onerror = () => computeAndApply(el, 800, 600);
  } else {
    el = document.createElement('iframe');
    el.src = `https://www.youtube.com/embed/${item.id}?autoplay=1`;
    el.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    el.allowFullscreen = true;
    el.style.display = 'block';
    el.style.border = '0';
    el.style.transformOrigin = '50% 50%';
    // assume 16:9 intrinsic
    requestAnimationFrame(() => computeAndApply(el, 1280, 720));
  }
  modalMedia.appendChild(el);
  // set transform to stored angle (in case angle exists)
  el.style.transform = `rotate(${rotationAngle}deg)`;
}

/* compute and apply sizes correctly:
   - s = min(maxW / (intrW*cos + intrH*sin), maxH / (intrW*sin + intrH*cos), 1)
   - displayW = intrW * s; displayH = intrH * s
   - rotW = abs(displayW*cos) + abs(displayH*sin)
   - rotH = abs(displayW*sin) + abs(displayH*cos)
   - set media size to displayW/displayH, modal-content to rotW/rotH, rotate media
*/
function computeAndApply(mediaEl, intrW, intrH) {
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const padRatio = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--overlay-pad')) || 0.05;
  const maxW = Math.max(100, vw * (1 - 2 * padRatio));
  const maxH = Math.max(100, vh * (1 - 2 * padRatio));

  const a = rotationAngle % 360;
  const rad = a * Math.PI / 180;
  const cos = Math.abs(Math.cos(rad));
  const sin = Math.abs(Math.sin(rad));

  const denomW = intrW * cos + intrH * sin;
  const denomH = intrW * sin + intrH * cos;

  const sW = denomW > 0 ? maxW / denomW : 1;
  const sH = denomH > 0 ? maxH / denomH : 1;
  const s = Math.min(sW, sH, 1);

  const displayW = Math.round(intrW * s);
  const displayH = Math.round(intrH * s);

  const rotW = Math.round(Math.abs(displayW * Math.cos(rad)) + Math.abs(displayH * Math.sin(rad)));
  const rotH = Math.round(Math.abs(displayW * Math.sin(rad)) + Math.abs(displayH * Math.cos(rad)));

  // Apply to media element (unrotated size)
  mediaEl.style.width = displayW + 'px';
  mediaEl.style.height = displayH + 'px';
  mediaEl.style.maxWidth = 'none';
  mediaEl.style.maxHeight = 'none';

  // Apply modal container to rotated bounding box
  modalContent.style.width = rotW + 'px';
  modalContent.style.height = rotH + 'px';

  // apply rotation (keeps centered)
  mediaEl.style.transform = `rotate(${rotationAngle}deg)`;
}

/* ---------- Controls ---------- */
rotateBtn.addEventListener('click', () => {
  rotationAngle = (rotationAngle + 90) % 360;
  items[currentIndex].angle = rotationAngle; // persist
  const el = modalMedia.firstElementChild;
  if (!el) return;
  // recompute using intrinsic sizes
  const intrW = (el.tagName === 'IFRAME') ? 1280 : (el.naturalWidth || el.width || 800);
  const intrH = (el.tagName === 'IFRAME') ? 720 : (el.naturalHeight || el.height || 600);
  computeAndApply(el, intrW, intrH);
});

nextBtn.addEventListener('click', () => {
  currentIndex = (currentIndex + 1) % items.length;
  rotationAngle = items[currentIndex].angle || 0;
  showMedia(currentIndex);
});
prevBtn.addEventListener('click', () => {
  currentIndex = (currentIndex - 1 + items.length) % items.length;
  rotationAngle = items[currentIndex].angle || 0;
  showMedia(currentIndex);
});

closeBtn.addEventListener('click', closeModal);
window.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

window.addEventListener('resize', () => {
  const el = modalMedia.firstElementChild;
  if (!el) return;
  const intrW = (el.tagName === 'IFRAME') ? 1280 : (el.naturalWidth || el.width || 800);
  const intrH = (el.tagName === 'IFRAME') ? 720 : (el.naturalHeight || el.height || 600);
  computeAndApply(el, intrW, intrH);
});
</script>
</body>
</html>
