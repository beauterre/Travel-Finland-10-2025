<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gallery with Lightbox and Controls</title>
<style>
body {margin:0; font-family:sans-serif; background:#f0f8ff;}
h1 {text-align:center; margin:20px auto;}
#gallery {
  display:flex; overflow-x:auto; gap:1rem; padding:20px;
  box-shadow:inset 0 4px 10px rgba(0,0,0,0.2);
}
.thumb {
  flex:0 0 150px; height:150px; border-radius:8px;
  overflow:hidden; cursor:pointer; position:relative;
  box-shadow:0 4px 10px rgba(0,0,0,0.2);
}
.thumb img {width:100%; height:100%; object-fit:cover;}
.thumb.video .play-btn {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width:40px; height:40px; border-radius:50%;
  background:rgba(0,0,0,0.7); color:white;
  display:flex; align-items:center; justify-content:center;
  font-size:20px; pointer-events:none;
}
.modal {
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,0.8);
  justify-content:center; align-items:center; z-index:1000;
}
.modal-content {
  position:relative; background:#fff; border-radius:12px;
  text-align:center; overflow:hidden; transition:all 0.3s ease;
  display:flex; justify-content:center; align-items:center;
  padding:10px;
}
#modal-media img, #modal-media iframe {
  max-width:90vw; max-height:85vh; object-fit:contain;
  transition:transform 0.3s ease;
  display:block;
}
.close-btn {
  position:absolute; top:10px; right:10px; background:#fff;
  width:30px; height:30px; border-radius:50%; font-size:24px;
  line-height:26px; cursor:pointer; z-index:10;
}
.controls {
  position:absolute; top:10px; left:50%; transform:translateX(-50%);
  display:flex; gap:10px; z-index:10;
}
.control-btn {
  background:rgba(0,0,0,0.6); color:white; border:none;
  width:40px; height:40px; border-radius:50%; font-size:18px;
  cursor:pointer; display:flex; justify-content:center; align-items:center;
}
.control-btn:hover {background:rgba(0,0,0,0.9);}
</style>
</head>
<body>
<h1>Gallery with Lightbox and Controls</h1>
<div id="gallery"></div>

<div id="modal" class="modal">
  <div class="modal-content">
    <span id="closeBtn" class="close-btn">&times;</span>
    <div id="modal-media"></div>
    <div class="controls">
      <button id="prevBtn" class="control-btn">‚ùÆ</button>
      <button id="rotateBtn" class="control-btn">üîÑ</button>
      <button id="nextBtn" class="control-btn">‚ùØ</button>
    </div>
  </div>
</div>

<script>
const photoPath = "./fotos/Dag9/";
const items = [
  { kind:"image", url:"Screenshot_20251010-175907.png" },
  { kind:"youtube", id:"JYt82UGhnOM" },
  { kind:"image", url:"IMG-20251010-WA0003.jpeg" }
];

let currentIndex=-1, rotationAngle=0;
const gallery=document.getElementById('gallery');
const modal=document.getElementById('modal');
const modalMedia=document.getElementById('modal-media');
const modalContent=document.querySelector('.modal-content');
const rotateBtn=document.getElementById('rotateBtn');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const closeBtn=document.getElementById('closeBtn');

// build thumbnails
items.forEach((item,i)=>{
  const t=document.createElement('div');
  t.className='thumb'+(item.kind==='youtube'?' video':'');
  const img=document.createElement('img');
  img.src=item.kind==='image'?photoPath+item.url:`https://img.youtube.com/vi/${item.id}/0.jpg`;
  img.dataset.index=i;
  if(item.kind==='youtube'){
    const play=document.createElement('div');
    play.className='play-btn'; play.textContent='‚ñ∂';
    t.appendChild(play);
  }
  t.appendChild(img);
  gallery.appendChild(t);
});

gallery.addEventListener('click',e=>{
  const img=e.target.closest('img');
  if(!img)return;
  currentIndex=parseInt(img.dataset.index);
  rotationAngle=0;
  showMedia(currentIndex);
  modal.style.display='flex';
  document.body.style.overflow='hidden';
});

function showMedia(i){
  modalMedia.innerHTML='';
  const item=items[i];
  let el;
  if(item.kind==='image'){
    el=document.createElement('img');
    el.src=photoPath+item.url;
  } else {
    el=document.createElement('iframe');
    el.src=`https://www.youtube.com/embed/${item.id}?autoplay=1`;
    el.allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    el.allowFullscreen=true;
    el.style.aspectRatio='16/9';
    el.style.border='none';
  }
  el.style.transform=`rotate(${rotationAngle}deg)`;
  modalMedia.appendChild(el);
  requestAnimationFrame(()=>fitModalToContent(el));
}

rotateBtn.addEventListener('click',()=>{
  rotationAngle=(rotationAngle+90)%360;
  const el=modalMedia.firstElementChild;
  if(!el)return;
  el.style.transform=`rotate(${rotationAngle}deg)`;
  fitModalToContent(el);
});

nextBtn.addEventListener('click',()=>{currentIndex=(currentIndex+1)%items.length;rotationAngle=0;showMedia(currentIndex);});
prevBtn.addEventListener('click',()=>{currentIndex=(currentIndex-1+items.length)%items.length;rotationAngle=0;showMedia(currentIndex);});
closeBtn.addEventListener('click',closeModal);
window.addEventListener('click',e=>{if(e.target===modal)closeModal();});
function closeModal(){modal.style.display='none';document.body.style.overflow='auto';modalMedia.innerHTML='';}

// dynamically fit modal to rotated element
function fitModalToContent(el) {
  const vw = window.innerWidth, vh = window.innerHeight;
  let naturalW, naturalH;

  if (el.tagName === 'IFRAME') {
    // Assume a standard 16:9 YouTube frame as intrinsic base
    naturalW = 1280;
    naturalH = 720;
  } else {
    naturalW = el.naturalWidth || el.videoWidth || el.clientWidth;
    naturalH = el.naturalHeight || el.videoHeight || el.clientHeight;
  }

  const rad = rotationAngle * Math.PI / 180;
  const rotW = Math.abs(naturalW * Math.cos(rad)) + Math.abs(naturalH * Math.sin(rad));
  const rotH = Math.abs(naturalW * Math.sin(rad)) + Math.abs(naturalH * Math.cos(rad));

  // Scale down if too big
  const scale = Math.min(vw * 0.9 / rotW, vh * 0.9 / rotH, 1);
  const w = rotW * scale;
  const h = rotH * scale;

  // Resize modal
  modalContent.style.width = w + 'px';
  modalContent.style.height = h + 'px';

  // Resize video element explicitly to fill modal
  if (el.tagName === 'IFRAME') {
    el.style.width = w + 'px';
    el.style.height = (w * 9 / 16) + 'px';
    el.style.maxWidth = '100%';
    el.style.maxHeight = '100%';
  } else {
    el.style.maxWidth = '100%';
    el.style.maxHeight = '100%';
  }
}

</script>
</body>
</html>
